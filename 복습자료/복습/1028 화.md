# 1028 화

</br>
</br>
</br>

## DataFrame (데이터 프레임)

- **표**를 다루는 Pandas의 타입
- 값이 하나의 방향으로 구성되어 있다 (2차원 자료구조)
- 값을 호출 할 때 2개의 인덱스가 필요하다
- 각 행렬은 식별자를 가지며 Series와 같이 두 가지 종류가 있다

</br>
</br>
</br>

## DataFrame 생성

#### 직접 생성
>pd.DataFrame(data [, index=None, columns=None])

#### Data
- DataFrame을 구성할 값을 설정
- 행렬의 수가 같아야 한다
- Series, List, ndarray를 담은 **2차원 배열**

</br>
</br>

<code>
<pre>
d = {
    "id": ["id-"+str(i) for i in range(1, 6)], 
    "korean": [100, 50, 70, 60, 90],
    "english": [90, 80, 100, 100, 40]
}
grade = pd.DataFrame(d)
grade

column name : id, korea, english
index name  : 0, 1, 2, 3, 4



l = [
    [10,     20,   30,     40], 
    [100,   200,  300,   400], 
    range(1000, 4001, 1000), 
]
df = pd.DataFrame(l)
df <- 컬럼, 행 이름이 정해지지 않은 DataFrame


df2 = pd.DataFrame(
    l,
    columns=["col1", "col2", "col3", "col4"], # 컬럼명 지정.
    index=["row1", "row2", "row3"]            # 행이름 지정
)
</pre>
</code>


#### 간단 정리
>컬럼명을 지정해서 만들 수도 있지만 지정을 안할 수도 있다.
후에 컬럼명이나 인덱스 명을 지정하려면 columns, index method를 사용해 지정가능.
직접 csv파일을 만드는 경우는 드물다.

</br>
</br>
</br>

## DataFrame에 저장된 값들을 파일에 저장

- DataFrame은 다양한 형식의 파일로 저장할 수 있다.
- DataFrame객체.to_저장형식()

>예시
DataFrame객체.to_csv(파일경로, sep=',', index=True, header=True)
- csv파일로 저장
- 파일경로 : 저장할 파일경로(경로/파일명)
- sep : 데이터 구분자 (',') <-csv로 저장할 시 사용
- index, header : 인덱스/헤더 저장여부

</br>
</br>
</br>

<code>
<pre>
import os


os.makedirs("saved_data", exist_ok=True)
#saved_data  디렉토리를 생성한다
#exist_ok   이미 존재한다면 오류 발생없이 넘어간


grade.to_csv("saved_data/grade1.csv")
#saved_data/grade1.csv  saved_data 안에 grade1.csv 파일을 생성한다


grade.to_csv("saved_data/grade2.csv", index=False)
#index name은 저장 안하기.
#(양수 index를 index name으로 사용한 경우)


grade.to_csv("saved_data/grade3.csv", 
            index=False, # index name 저장안하기
            header=False # column name 저장안함.
            )
#Header name 저장하지 않기
#index name, column name을 저장하지 않은 경우 자동 증가

</pre>
</code>


</br>
</br>
</br>

## Database 테이블에 저장

>만들었던 csv파일을 MySQL에 저장할 수 있

<code>
<pre>

import pandas as pd                     #모듈 불러오기
from sqlalchemy import create_engine    #모듈 불러오기

user = "root"           #MySQL에 사용하는 정보입력
password = "0000"
host = "localhost"
port = 3306
database = "hr_join"

conn_str = f"mysql+pymysql://{user}:{password}@{host}:{port}/{database}"
#mysql에 연결할거야
#pymysql 을 이용해서 연결할거야
#https://와 같이 ://을 이용해 URL생성


# DB 연결
engine = create_engine(conn_str)

# 4. 데이터 INSERT (append 모드)
grade.to_sql(
    name="grade",         # 테이블명
    con=engine,           # connection
    if_exists="append",   # 테이블이 있으면 데이터 추가. replace: 테이블 삭제후 다시 생성 fail: 테이블이 있으면 에러
    index=False           # DataFrame의 index는 저장안함.

</pre>
</code>

</br>
</br>
</br>


## 파일로 데이터셋을 읽고 생성하기

>pd.read_csv(파일경로, sep=',', header, index_col, na_values)

- 파일경로 : 읽어 올 파일의 경로
- sep : 구분자 (기본값:쉼표)
- header : 기본값:첫 번째 행을 Header로 읽는다
- index_col : index명으로 사용할 문자열,정수를 지정
- na_values : 읽어올 데이터셋의 값 중 결측치로 처리할 문자열 지정


</br>
</br>
</br>


## 주요 메소드 및 속성
>Series에 나오는 메소드 및 속성과 거의 비슷하다
</br>
- head(정수) : 데이터 정수 행만큼 조회 (기본값 5)
- tail(정수) : 데이터 정수 행만큼 조회 (기본값 5)
- shape, size : 행렬의 수를 튜플로 리턴, 원소의 총 개수
- columns : 열의 이름 조회 및 변경
- index : index 이름을 조회 및 변경
- describe() : 요약 통계량 제공
- info() : 각 열 별 데이터 타입과 결측치 개수 조회
- count() : 열별 결측치를 제외한 원소 개수
- nunique() : 열별 고유 값의 개수 조회
- dropna() : 결측치가 있는 행열 제거


</br>
</br>
</br>


## 컬럼 이름 / 행 이름 변경

>columns, index 속성을 통째로 변경은 가능하나, 일부 변경은 불가능

</br>

#### 일부 변경을 하기 위해서는 메소드 필요

</br>
<code>
<pre>

#특정(개별) 컬럼명들, 행이름들을 변경
#dictionary : {원래이름:바꿀이름, ...}

new_columns = {
    "ID": "학생 아이디", 
    "국어": "국어1"
}

new_index = {
    "1번": "일번", 
    "3번": "삼번"
}

grade.rename(columns=new_columns)  #컬럼명 변경

#grade.rename(index=new_index)      #index 명(행이름) 변경

grade.rename(                      #한번에 다 변경
    index=new_index,
    columns=new_columns, 
    inplace=True
)


</pre>
</code>


## Index 이름 처리 및 행열의 값 변경

>DataFrame객체.set_index(컬럼이름, inplace=False)
- 컬럼이름을 index명으로 사용
- 열이 index가 되면서 그 컬럼은 Data set에서 제거

</br>

>DataFrame객체.reset_index(drop=False, inplace=False)
- index를 첫 번째 컬럼으로 복원
- drop-True로 하면 index name을 삭제하고 자동증가 index로 변경

</br>

>DataFrame객체.drop(columns, index, inplace=True)
- columns : 삭제할 열 이름 또는 열이름 리스트
- index : 삭제할 index명 또는 index 리스트
- inplace : 원본을 변경할지 여부

</br>

>DataFrame객체.drop_duplicates()
- 중복 행을 제거하고 한 행(첫 번째 행)만 남긴다
- subset=컬럼명, subset=c1,c2 등 파라미터를 이용해 중복행 기준을 지정할 수 있다

</br>

- 열 삽입 : df.insert(삽입 위치 index, 삽입할 열이름, 값)
- 열 추가 : df['새 열 이름'] = 값 (append와 비슷함)
- 행 추가 : df.loc[추가할 행 index이름] = 추가할 값 


</br>
</br>
</br>

#### 총점과 평균값을 구하고 추가하기

<code>
<pre>

grade2 = grade.drop(columns=['총점', '평균'])   #이전 컬럼 제거
total = grade2.sum(axis=1)                      #axis=1(행 방향) 값 총점
avg = round(grade2.mean(axis=1), 2)             #행 방향 평균값 산출
grade2['total'] = total                         #total변수를 열에 추가
grade2['avg'] = avg                             #avg변수를 열에 추가
grade2

</pre>
</code>

</br>
</br>
</br>

## 열을 조회하는 다양한 메소드

>select_dtype (include=[데이터 타입])
- 데이터 타입으로 열 조회
- include : 조회할 열 데이터 타입
- exclude : 제외하고 조회할 열 데이터 타입

</br>

>fillter (items=[])
- items = [컬럼명들] : 리스트와 일치하는 열 조회, 일치 안해도 에러 없음
- like = '부분일치문자열' : 부분만 일치해도 열 조회
- regex = '정규표현식' : 정규표현식으로 조회


</pre>
</code>

#\d : 숫자 1개   $ 끝.
#^: 시작, \w: 정수 또는 글자 또는 공백
#{n} : n 글자수


grade3.filter(regex=r"\d$")  
#정수로 끝나는 이름의 컬럼들을 조회


#grade3.filter(regex=r"^\w{4}$") # 4글자인 컬럼

grade3.filter(regex=r"^\w{4}$") 
#4글자인 컬럼



</pre>
</code>


</br>
</br>
</br>

## 행을 조회하는 다양한 메소드
- df.loc[index 이름] : 한 행 조회
- df.loc[index 이름 리스트] : 여러 행 조회
- df.loc[start index이름 : end index이름 : step]
- df.loc[index 이름, 컬럼이름] : 행과 열 조회

</br>
</br>
</br>

>이전 시간에 했던 Series와 중복되는 부분이 많아 쉬운 부분도 있었지만 많은 Method와 새로운 개념들이 있다

